# Cross_Contract_Conflict_Benchmark_C3B_dataset

A dataset generation pipeline for creating large-scale contract clause contradiction corpora using Ollama + ContractNLI.

---

## Overview

This project generates a large dataset of **modified legal contract clauses** where each clause is rewritten to subtly change its meaning (e.g., reversing obligations, weakening rights, shifting liability).  
Each rewritten clause is verified using a **Natural Language Inference (NLI)** model (e.g., `roberta-large-mnli`) to keep only meaning-altering rewrites.

Output structure follows the CUAD dataset format:

- Contract types → PDFs → clauses → modified clauses + change logs  
- Fully resumable, interrupt-safe, GPU-compatible

The generator supports:

- Incremental resume  
- Safe interruption  
- Automatic logging  
- CPU/GPU NLI verification  
- Ollama-based rewriting  
- Per-file rewrite probability  
- Reproducibility (seeded)

---

## Directory Structure
full_contract_pdf/

├── Part_I/

├── Part_II/

├── Part_III/          ← Source CUAD-like folders

├── generate_c3d.py    ← Main generator script

├── annotated_small/   ← Output (example)

├── annotated_large/   ← Output (example)

---

## Installation

### Install Python dependencies

```
pip install -r requirements.txt
```

### Install Ollama
Install from: https://ollama.ai

Then pull a model:

```
ollama pull mistral
```

GPU support is optional but recommended for `roberta-large-mnli`.

---

## How It Works

1. PDF text is extracted and split into clauses.  
2. Each clause has a probability (`--change-prob`) of being rewritten.  
3. Rewritten text is generated by an Ollama model (default: `mistral`).  
4. ContractNLI / MNLI evaluates the **contradiction score**.  
5. Only clauses above `--contradiction-threshold` are accepted.  
6. Output is saved to an `annotated_*` directory with:
   - `modified.txt`
   - `changes.json`
   - original.pdf

---

## Resume Behavior

The generator automatically resumes, meaning:
- If a file already exists in output directory, it is skipped.
- If a run is interrupted (Ctrl+C), already completed files stay completed.
- Re-running the command continues remaining files.

### Force a clean rebuild:
```
--fresh
```

This will delete the target output directory and start over.

---

## Logging

For an output folder like `annotated_small`, the log file is:
```
run_annotated_small.txt
```
Each run appends:
- Timestamp
- Full argument list
- Per-file stats
- Final aggregated totals

At the end, a full summary is computed fresh from the output directory:
- total types
- total modified_kept
- total modified_discarded
- total ollama_failed
- total unchanged

This allows safe interruption + exact reproducibility.

---

## Usage Examples

### Minimal run

Process 1 file per contract type:
```
python generate_c3d.py --out annotated_small --num-files 1 --change-prob 0.2 --contradiction-threshold 0.5
```

### Full large run

Process all files in the dataset:

```
python generate_c3d.py \
  --out annotated_large \
  --change-prob 0.2 \
  --contradiction-threshold 0.5
```

### Start

```
python generate_c3d.py \
  --out annotated_small \
  --fresh \
  --num-files 1 \
  --change-prob 0.2 \
  --contradiction-threshold 0.5
```

### Output Example

For each PDF:
```[✓] Franchise/XYZ_Agreement.pdf — 
    4 modified_kept, 
    33 unchanged, 
    0 ollama_failed, 
    6 discarded_low_contradiction
```
---

